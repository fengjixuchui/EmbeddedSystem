# 计算速度优化问题

客户发现计算任务在打开了浮点功能的情况下，运行速度还不够快，因为裸机情况下计算耗时只需要 25us 左右，而使用我们的系统则要消耗 650us 左右，经过一番排查，我认为问题出现在 cache 上。但是经过代码检查，发现系统中的 cache 是开着的，这就使人非常疑惑了，但是感觉问题一定出现在这里，所以仍然怀疑是 cache 的配置问题。

经过仔细阅读手册后发现，现有 cortex-a9 单核系统中的 Cache 配置是有问题的。单核情况下，NORMAL 类型的内存被配置成了 shared 属性。这样的配置，会让 CPU 不知道这块内存是要和谁共享，因此就将这块内存认为值 non-cached，也就是 cache 失效了。

后来修改在单核时将 NORMAL 内存配置成 只 cached 而不 shared，这样在单核的情况下，这块内存就能被缓存了，进而加快了客户应用的运行速度。这块代码先前在 A7 上运行正常，但是相同的寄存器位在不同的芯片上意义不同，所以带来了这种错误。现在已经在代码中使用芯片宏对相关内存进行了单独配置。

## 结论

在不同的芯片上，相同的配置意义可能不同，不能想当然的认为开启了相同的功能就会有相同的结果。