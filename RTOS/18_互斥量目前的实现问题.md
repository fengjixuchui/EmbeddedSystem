# 互斥量目前的实现问题

## 问题一

互斥量 flag 使用 FIFO 模式。

A（优先级20）已经获得互斥锁
此时 B（优先级 10） 尝试获取互斥锁
此时 C (优先级 1) 尝试获取互斥锁

当此时 A 的优先级被暂时提高到 1，等运行完毕后 A 线程会把锁交给线程 B，使得线程 B 开始运行，但是此时再也不会将 B 的优先级提升到 C 的优先级了，此时 C 就必须等到 B 完全运行退出，相当于再次出现了优先级反转问题。

这里问题的关键是，提升优先级的动作只会发生一次。

## 问题二

A（优先级20）已经获得互斥锁
此时 B（优先级 1） 尝试获取互斥锁

如果 B 因为超时退出，而 A 的优先级任然被短暂提高，造成 A 线程意外得到了运行。